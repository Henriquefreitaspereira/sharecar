<!DOCTYPE html>
<html>
<head>
<title>ShareCar</title>
<link href="css/jquery-ui-1.9.2.custom.css" rel="stylesheet" media="screen" />
<link href="css/main.css" rel="stylesheet" media="screen" />
<script src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=geometry,places"	type="text/javascript"></script>
<script src='js/jquery-1.9.1.min.js' type='text/javascript'></script>
<script src='js/jquery-ui-1.9.2.custom.js' type='text/javascript'></script>
<script src='js/globalize.js' type='text/javascript'></script>
<script src='js/globalize-de.js' type='text/javascript'></script>
<script src='js/main.js' type='text/javascript'></script>
<script>
	$(function(){
		
		carregarMapaCentralizadoConformeGeolocalizacaoDoUsuario();
		carregarTabelaDeRotas();
    $( "#accordion" ).accordion({
        heightStyle: "fill",
        active: 1
    });
    $( "#slider" ).slider({
        value:100,
        min: 50,
        max: 1000,
        step: 50,
        slide: function( event, ui ) {
          $( "#raio" ).val(ui.value);
        }
     });
     $( "#raio" ).val( $( "#slider" ).slider( "value" ) );
     $( "#radio" ).buttonset();


     $.widget( "ui.timespinner", $.ui.spinner, {
    	    options: {
    	      // 30 minutos
    	      step: 1800 * 1000,
    	      // 1 hora
    	      page: 60
    	    },
    	 
    	    _parse: function( value ) {
    	      if ( typeof value === "string" ) {
    	        // already a timestamp
    	        if ( Number( value ) == value ) {
    	          return Number( value );
    	        }
    	        return +Globalize.parseDate( value );
    	      }
    	      return value;
    	    },
    	 
    	    _format: function( value ) {
    	      return Globalize.format( new Date(value), "t" );
    	    }
    	  });
     		Globalize.culture("de-DE");
    	 	$( "#hora-ini, #hora-fim" ).timespinner();
    	 
    	 
		

		// Mostra a rota no mapa após clicar no ícone da tabela de rotas
		$("#table-rotas").delegate("a[name^='route-']", "click", function(){ mostrarRota($(this).attr("route")) });

		// Alterando o ponto de partida a rota é mostrada a nova rota
		var ptoPartida = new google.maps.places.Autocomplete($("#pto-partida")[0]);
    var ptoChegada = new google.maps.places.Autocomplete($("#pto-chegada")[0]);
		google.maps.event.addListener(ptoChegada, 'place_changed', function() {
			mostrarRotaNoMapa($("#pto-partida").val(), $("#pto-chegada").val());
		});

		// Salva a rota
		// TODO: Ajustar para quando o usuário alterar a rota
		$("#btSalvar").click(function(){
			pegarRota($("#pto-partida").val(), $("#pto-chegada").val(), function(coords){
				var coordenadas = new Array();
				for (var i = 0; i < coords.length; i++){
					coordenadas.push(new Coord(coords[i].Ya, coords[i].Za));
				}

				var rota = new Rota("Rota " + (new Date()).getTime(), user, coordenadas);
				$.ajax({	
						  type: "PUT",
						  url: "http://localhost:8080/sharecar/api/route",
						  data: JSON.stringify(rota),
						  dataType: "json",
						  contentType: "application/json;charset=UTF-8",
						  success: function(){
								alert('Rota salva com sucesso.');
								carregarTabelaDeRotas();
							}
						});
				});
		});
		    
	});
</script>
</head>
<body>
	<div id="formulario">
		<div id="accordion">
			<h3>Criar Rota</h3>
			<div>
				<label for="descricao">Descrição:</label><br/> 
				<input id="descricao" style="width: 100%" value="teste"/><br/> 
				<label for="pto-partida">Ponto de Partida:</label><br/> 
				<input id="pto-partida" style="width: 100%" value="augusto lopes pontes, 170"/><br/> 
				<label for="pto-chegada">Ponto de Chegada:</label><br/> 
				<input id="pto-chegada" style="width: 100%"	value="augusto lopes pontes, 581"/><br/>
				<input type="button" id="btSalvar" value="Salvar"/>
				<br/><br/>
				<table id="table-rotas" class="table table-bordered">
					<thead>
						<tr>
							<th class="ui-widget-header" colspan="2">Minhas Rotas</th>
						</tr>
					</thead>
					<tbody></tbody>
				</table>
			</div>
			<h3>Buscar Carona</h3>
			<div>
				<p>
 					<label for="raio">Buscar rotas num raio de</label>
  				<input type="text" id="raio" name="raio" style="width: 55px; border: 0; color: #f6931f; font-weight: bold; text-align:center" readonly/> metros
				</p>
				<div id="slider"></div>
				<p>
					<label for="endereco">que esteja perto do endereço (marque um ponto no mapa)</label>
					<textarea id="endereco" style="width:390px; height: 50px; font-size: 10pt" readonly></textarea>
				</p>
				<p>
					no dia da semana:
					<div id="radio">
    				<input type="radio" id="radio1" name="radio" /><label for="radio1" style="font-size:10pt; width:50px;">Dom</label>
    				<input type="radio" id="radio2" name="radio" /><label for="radio2" style="font-size:10pt; width:50px;">Seg</label>
    				<input type="radio" id="radio3" name="radio" /><label for="radio3" style="font-size:10pt; width:50px;">Ter</label>
    				<input type="radio" id="radio4" name="radio" /><label for="radio4" style="font-size:10pt; width:50px;">Qua</label>
    				<input type="radio" id="radio5" name="radio" /><label for="radio5" style="font-size:10pt; width:50px;">Qui</label>
    				<input type="radio" id="radio6" name="radio" /><label for="radio6" style="font-size:10pt; width:50px;">Sex</label>
    				<input type="radio" id="radio7" name="radio" /><label for="radio7" style="font-size:10pt; width:50px;">Sáb</label>
  				</div>
				</p>
				<p>
					entre	
					<input id="hora-ini" name="hora-ini" value="08:00" style="width: 60px" readonly/> e <input id="hora-fim" name="hora-fim" value="09:00" style="width: 60px" readonly/>
				</p>
			</div>
		</div>
	</div>
	<div id="mapa"></div>
</body>
</html>