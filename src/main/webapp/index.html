<!DOCTYPE html>
<html>
<head>
<title>ShareCar</title>
<link href="css/jquery-ui-1.9.2.custom.css" rel="stylesheet" media="screen" />
<link href="css/main.css" rel="stylesheet" media="screen" />
<script src='js/jquery-1.9.1.min.js' type='text/javascript'></script>
<script src='js/jquery-ui-1.9.2.custom.js' type='text/javascript'></script>
<script src='js/main.js' type='text/javascript'></script>
<script src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=geometry,places"	type="text/javascript"></script>
<script>
	$(function(){
		
		carregarMapaCentralizadoConformeGeolocalizacaoDoUsuario();
		carregarTabelaDeRotas();
		$('#tabs').tabs({ active: 1 });

		// Mostra a rota no mapa após clicar no ícone da tabela de rotas
		$("#table-rotas").delegate("a[name^='route-']", "click", function(){ mostrarRota($(this).attr("route")) });

		// Alterando o ponto de partida a rota é mostrada a nova rota
		var ptoPartida = new google.maps.places.Autocomplete($("#pto-partida")[0]);
    var ptoChegada = new google.maps.places.Autocomplete($("#pto-chegada")[0]);
		google.maps.event.addListener(ptoChegada, 'place_changed', function() {
			mostrarRotaNoMapa($("#pto-partida").val(), $("#pto-chegada").val());
		});

		// Salva a rota
		// TODO: Ajustar para quando o usuário alterar a rota
		$("#btSalvar").click(function(){
			pegarRota($("#pto-partida").val(), $("#pto-chegada").val(), function(coords){
				var coordenadas = new Array();
				for (var i = 0; i < coords.length; i++){
					coordenadas.push(new Coord(coords[i].Ya, coords[i].Za));
				}

				var rota = new Rota("Rota " + (new Date()).getTime(), user, coordenadas);
				$.ajax({	
						  type: "PUT",
						  url: "http://localhost:8080/sharecar/api/route",
						  data: JSON.stringify(rota),
						  dataType: "json",
						  contentType: "application/json;charset=UTF-8",
						  success: function(){
								alert('Rota salva com sucesso.');
								carregarTabelaDeRotas();
							}
						});
				});
		});
		    
	});
</script>
</head>
<body>
	<div id="formulario">
		<div id="tabs">
			<ul>
				<li><a href="#tabs-1">Buscar Carona</a></li>
				<li><a href="#tabs-2">Criar Rota</a></li>
			</ul>
			<div id="tabs-1">
				<p>Tab-1</p>
			</div>
			<div id="tabs-2">
				<label for="descricao">Descrição:</label><br /> 
				<input id="descricao" style="width: 100%" value="teste"/><br/> 
				<label for="pto-partida">Ponto de Partida:</label><br/> 
				<input id="pto-partida" style="width: 100%" value="augusto lopes pontes, 170"/><br/> 
				<label for="pto-chegada">Ponto de Chegada:</label><br/> 
				<input id="pto-chegada" style="width: 100%"	value="augusto lopes pontes, 581"/><br/>
				<input type="button" id="btSalvar" value="Salvar"/>
				<input type="button" id="btVer" value="Ver Rota"/>
				<br/><br/>
				<table id="table-rotas" class="table table-bordered">
					<thead>
						<tr>
							<th class="ui-widget-header" colspan="2">Minhas Rotas</th>
						</tr>
					</thead>
					<tbody></tbody>
				</table>
			</div>
		</div>
	</div>
	<div id="mapa"></div>
</body>
</html>